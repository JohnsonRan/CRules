# ç­–ç•¥ç»„ç›¸å…³
pr: &pr {type: select, proxies: [èŠ‚ç‚¹é€‰æ‹©, ğŸ‡­ğŸ‡° é¦™æ¸¯, ğŸ‡¼ğŸ‡¸ å°æ¹¾, ğŸ‡¯ğŸ‡µ æ—¥æœ¬, ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡, ğŸ‡ºğŸ‡¸ ç¾å›½, å…¶ä»–, DIRECT]}
url-test: &url-test {type: url-test, url: http://latency-test.skk.moe/endpoint, interval: 300, include-all: true}
fallback: &fallback {type: fallback, url: http://latency-test.skk.moe/endpoint, interval: 300, include-all: true}
# è¿™é‡Œæ˜¯è®¢é˜…æ›´æ–°å’Œå»¶è¿Ÿæµ‹è¯•ç›¸å…³çš„
p: &p {type: http, interval: 86400, health-check: {enable: true, url: "http://latency-test.skk.moe/endpoint", interval: 600}}

# https://hub.docker.com/r/xream/sub-store
proxy-providers:
  provider1:
    <<: *p
    url: "http://172.16.1.50:3001/D2UhuYViWtqwddacM4ss/download/collection/AIO"

mixed-port: 7890
ipv6: false
log-level: warning
allow-lan: true
unified-delay: true
tcp-concurrent: true
external-ui: ui
external-ui-name: metacubexd
external-controller: 0.0.0.0:9090
external-ui-url: https://mirror.ghproxy.com/https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip

geodata-mode: true
geox-url:
  geoip: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/release/geoip-lite.dat"
  geosite: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/release/geosite.dat"
  mmdb: "https://raw.githubusercontent.com/NobyDa/geoip/release/Private-GeoIP.mmdb"

profile:
  store-selected: true
  store-fake-ip: true

sniffer:
  enable: true
  force-dns-mapping: true
  parse-pure-ip: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - "Mijia Cloud"
    - "+.push.apple.com"

tun:
  enable: true
  stack: mixed
  device: JRAN
  endpoint-independent-nat: true
  auto-route: false
  auto-redirect: false
  auto-detect-interface: false

dns:
  enable: true
  ipv6: false
  listen: 0.0.0.0:1053
  enhanced-mode: fake-ip
  use-hosts: false
  use-system-hosts: false
  fake-ip-filter:
    - "+.lan"
    - "+.local"
    - "+.market.xiaomi.com"
  nameserver:
    - 223.5.5.5
    - 180.184.1.1
  nameserver-policy:
    "*": 127.0.0.1#lo
    "+.lan": 127.0.0.1#lo
    "+.local": 127.0.0.1#lo
    "geosite:geolocation-!cn":
      - https://doh.apad.pro/dns-query
      - https://223.5.5.5/dns-query

proxy-groups:
  - {name: èŠ‚ç‚¹é€‰æ‹©, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Global.png, type: select, proxies: [è‡ªåŠ¨é€‰æ‹©, ğŸ‡­ğŸ‡° é¦™æ¸¯, ğŸ‡¼ğŸ‡¸ å°æ¹¾, ğŸ‡¯ğŸ‡µ æ—¥æœ¬, ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡, ğŸ‡ºğŸ‡¸ ç¾å›½, å…¶ä»–, DIRECT]}
  - {name: è‡ªåŠ¨é€‰æ‹©, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Final.png, <<: *fallback}
  - {name: Emby, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Emby.png, <<: *pr}
  - {name: AI, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/AI.png, <<: *pr}
  - {name: Github, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/GitHub.png, <<: *pr}
  - {name: Telegram, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Telegram.png, <<: *pr}
  - {name: Google, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Google_Search.png, <<: *pr}
  - {name: YouTube, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/YouTube.png, <<: *pr}
  - {name: Tracker, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Download.png, type: select, proxies: [DIRECT, ğŸ‡­ğŸ‡° é¦™æ¸¯, ğŸ‡¼ğŸ‡¸ å°æ¹¾, ğŸ‡¯ğŸ‡µ æ—¥æœ¬, ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡, ğŸ‡ºğŸ‡¸ ç¾å›½]}
  - {name: æµåª’ä½“, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Netflix.png, <<: *pr}
  - {name: Porns, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Pornhub_1.png, <<: *pr}
  - {name: Bilibili, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/bilibili_4.png, type: select, proxies: [DIRECT, ğŸ‡­ğŸ‡° é¦™æ¸¯, ğŸ‡¼ğŸ‡¸ å°æ¹¾]}
  - {name: å·´å“ˆå§†ç‰¹, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Bahamut.png, type: select, proxies: [ğŸ‡¼ğŸ‡¸ å°æ¹¾, DIRECT]}
  - {name: Microsoft, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Microsoft.png, <<: *pr}
  - {name: MATCH, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Final.png, <<: *pr}

# åˆ†éš”,ä¸‹é¢æ˜¯åœ°åŒºåˆ†ç»„
  - {name: ğŸ‡­ğŸ‡° é¦™æ¸¯, <<: *url-test, filter: "(?i)ğŸ‡­ğŸ‡°|é¦™æ¸¯|(\b(HK|Hong)\b)", icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Hong_Kong.png}
  - {name: ğŸ‡ºğŸ‡¸ ç¾å›½, <<: *url-test, filter: "(?i)ğŸ‡ºğŸ‡¸|ç¾å›½|æ´›æ‰çŸ¶|åœ£ä½•å¡|(\b(US|United States)\b)", icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_States.png}
  - {name: ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡, <<: *url-test, filter: "(?i)ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|ç‹®|(\b(SG|Singapore)\b)", icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Singapore.png}
  - {name: ğŸ‡¯ğŸ‡µ æ—¥æœ¬, <<: *url-test, filter: "(?i)ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|ä¸œäº¬|(\b(JP|Japan)\b)", icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Japan.png}
  - {name: ğŸ‡¼ğŸ‡¸ å°æ¹¾, <<: *url-test, filter: "(?i)ğŸ‡¨ğŸ‡³|ğŸ‡¹ğŸ‡¼|å°æ¹¾|(\b(TW|Tai|Taiwan)\b)", icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/China.png}
  - {name: å…¶ä»–, <<: *url-test, exclude-filter: "HK|US|SG|JP|TW", icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Airport.png}

rules:
  - RULE-SET,custom_direct,DIRECT
  - RULE-SET,custom_proxy,èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,custom_reject,REJECT
  - RULE-SET,ADs_merged,REJECT
  - GEOSITE,biliintl,èŠ‚ç‚¹é€‰æ‹©
  - GEOSITE,tracker,Tracker
  - RULE-SET,ai,AI
  - GEOSITE,youtube,YouTube
  - GEOIP,google,Google
  - GEOSITE,google,Google
  - GEOIP,netflix,æµåª’ä½“
  - GEOSITE,netflix,æµåª’ä½“
  - GEOSITE,primevideo,æµåª’ä½“
  - GEOSITE,disney,æµåª’ä½“
  - GEOSITE,category-porn,Porns
  - GEOSITE,bilibili,Bilibili
  - GEOIP,telegram,Telegram
  - GEOSITE,telegram,Telegram
  - GEOSITE,github,Github
  - GEOSITE,microsoft,Microsoft
  - GEOSITE,bahamut,å·´å“ˆå§†ç‰¹
  - RULE-SET,emby,Emby
  - GEOSITE,CN,DIRECT
  - GEOIP,CN,DIRECT
  - MATCH,MATCH

rule-anchor:
  ip: &ip {type: http, interval: 86400, behavior: ipcidr, format: yaml}
  domain: &domain {type: http, interval: 86400, behavior: domain, format: yaml}
  domaintxt: &domaintxt {type: http, interval: 86400, behavior: domain, format: text}
  classical: &classical {type: http, interval: 86400, behavior: classical, format: yaml}
  classicaltxt: &classicaltxt {type: http, interval: 86400, behavior: classical, format: text}

# https://wiki.metacubex.one/config/syntax/#_7
# https://wiki.metacubex.one/config/rule-providers/content/#rule-providers
rule-providers:
  custom_direct:
    <<: *domain
    url: "https://raw.githubusercontent.com/JohnsonRan/CRules/master/rules/custom.yaml"
  custom_proxy:
    <<: *domain
    url: "https://raw.githubusercontent.com/JohnsonRan/CRules/master/rules/customProxy.yaml"
  custom_reject:
    <<: *domain
    url: "https://raw.githubusercontent.com/JohnsonRan/CRules/master/rules/reject.yaml"
  emby:
    <<: *classicaltxt
    url: "https://raw.githubusercontent.com/Repcz/Tool/X/Surge/Rules/Emby.list"
  ai:
    <<: *classical
    url: "https://gitlab.com/lodepuly/vpn_tool/-/raw/master/Tool/Clash/Rule/AI.yaml"
  ADs_merged:
    <<: *domaintxt
    url: "https://raw.githubusercontent.com/JohnsonRan/CRules/master/rules/ADs_merged.txt"