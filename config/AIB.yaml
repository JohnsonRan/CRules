# ç­–ç•¥ç»„ç›¸å…³
pr: &pr {type: select, proxies: [èŠ‚ç‚¹é€‰æ‹©, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶ä»–, DIRECT]}
url-test: &url-test {type: url-test, url: https://www.gstatic.com/generate_204, interval: 300, include-all-providers: true, exclude-filter: "LAN"}
fallback: &fallback {type: fallback, url: https://www.gstatic.com/generate_204, interval: 300, include-all-providers: true, exclude-filter: "LAN"}
load-balance: &load-balance {type: load-balance, url: https://www.gstatic.com/generate_204, interval: 300, include-all-providers: true, strategy: sticky-sessions, exclude-filter: "LAN"}
# è¿™é‡Œæ˜¯è®¢é˜…æ›´æ–°å’Œå»¶è¿Ÿæµ‹è¯•ç›¸å…³çš„
p: &p {type: http, interval: 86400, health-check: {enable: true, url: https://www.gstatic.com/generate_204, interval: 300}}

proxies:
  - {name: LAN, type: direct, udp: true, interface-name: br-lan}

# https://hub.docker.com/r/xream/sub-store
proxy-providers:
  Sub-Store:
    <<: *p
    url: "æ­¤å¤„å¡«å…¥ä½ çš„è®¢é˜…åœ°å€"

mixed-port: 7890
ipv6: false
log-level: silent
allow-lan: true
skip-auth-prefixes:
- 127.0.0.1/8
unified-delay: true
tcp-concurrent: true
external-ui: ui
external-ui-name: zashboard
external-controller: 0.0.0.0:9090
external-ui-url: https://raw.ihtw.moe/github.com/Zephyruso/zashboard/archive/refs/heads/gh-pages.zip

keep-alive-idle: 600
keep-alive-interval: 60

profile:
  store-selected: true
  store-fake-ip: true

sniffer:
  enable: true
  force-dns-mapping: false
  parse-pure-ip: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - "Mijia Cloud"
    - "+.push.apple.com"

tun:
  enable: true
  stack: mixed
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true

dns:
  enable: true
  ipv6: false
  respect-rules: true
  listen: 0.0.0.0:1053
  enhanced-mode: redir-host
  nameserver:
    - "https://208.67.222.2/dns-query"
    - "https://9.9.9.9/dns-query"
  proxy-server-nameserver:
    - 223.5.5.5
    - 101.226.4.6 #360
  nameserver-policy:
    "*": 127.0.0.1#lo
    "+.lan": 127.0.0.1#lo
    "+.local": 127.0.0.1#lo
    "+.ts.net": 127.0.0.1#tailscale0
    "rule-set:cn_site,apple":
      - 122.112.208.1 #huawei
      - 101.226.4.6

ntp:
  enable: true
  write-to-system: true

experimental:
  quic-go-disable-gso: false
  quic-go-disable-ecn: false

proxy-groups:
  - {name: èŠ‚ç‚¹é€‰æ‹©, icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/sub(1).png, type: select, proxies: [è‡ªåŠ¨é€‰æ‹©, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶ä»–, DIRECT]}
  - {name: è‡ªåŠ¨é€‰æ‹©, icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/lightning(2).png, <<: *fallback}
  - {name: Speedtest, icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/speedtest.png, type: select, proxies: [DIRECT, èŠ‚ç‚¹é€‰æ‹©, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½]}
  - {name: Emby, icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/emby.png, type: select, proxies: [èŠ‚ç‚¹é€‰æ‹©, ä½å€ç‡, DIRECT]}
  - {name: AI, icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/ChatGPT-green.png, <<: *pr}
  - {name: Apple, icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/apple.png, type: select, proxies: [ç¾å›½, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, DIRECT]}
  - {name: Github, icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/github.png, <<: *pr}
  - {name: Telegram, icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/telegram(blue1).png, <<: *pr}
  - {name: Google, icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/google(1).png, <<: *pr}
  - {name: YouTube, icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/youtube.png, <<: *pr}
  - {name: Tracker, icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/direct.png, type: select, proxies: [DIRECT, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½]}
  - {name: Porns, icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/yuyanyun.png, <<: *pr}
  - {name: Bilibili, icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/bilibili(1).png, type: select, proxies: [DIRECT, é¦™æ¸¯, å°æ¹¾]}
  - {name: Microsoft, icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/microsoft.png, <<: *pr}
  - {name: ADBlock, icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/ad(6).png, type: select, proxies: [REJECT, DIRECT]}
  - {name: MATCH, icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/shutiao.png, <<: *pr}

# åˆ†éš”,ä¸‹é¢æ˜¯åœ°åŒºåˆ†ç»„
  - {name: é¦™æ¸¯, <<: *url-test, filter: "ğŸ‡­ğŸ‡°|é¦™æ¸¯|HK|Hong", icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/Hongkong(2).png}
  - {name: ç¾å›½, <<: *url-test, filter: "ğŸ‡ºğŸ‡¸|ç¾å›½|US|United States", icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/US(1).png}
  - {name: æ–°åŠ å¡, <<: *url-test, filter: "ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|ç‹®|SG|Singapore", icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/singapore(2).png}
  - {name: æ—¥æœ¬, <<: *url-test, filter: "ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|ä¸œäº¬|JP|Japan", icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/Japan(1).png}
  - {name: å°æ¹¾, <<: *url-test, filter: "ğŸ‡¨ğŸ‡³|ğŸ‡¹ğŸ‡¼|å°æ¹¾|TW|Tai|Taiwan", icon: https://raw.ihtw.moe/https://github.com/lige47/QuanX-icon-rule/raw/main/icon/taiwan.png}
  - {name: ä½å€ç‡, icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/duck(1).png, <<: *fallback, filter: "(?i)(0\\.\\d+)"}
  - {name: å…¶ä»–, icon: https://raw.ihtw.moe/github.com/lige47/QuanX-icon-rule/raw/main/icon/XXAI.png, type: select, include-all-providers: true, exclude-filter: "HK|US|SG|JP|TW|LAN"}

rules:
  - DST-PORT,6881-6999,ADBlock #FUCK WPS
  - DST-PORT,3478/19302,DIRECT
  - GEOIP,lan,LAN,no-resolve
  - RULE-SET,custom_proxy,èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,custom_reject,ADBlock
  - RULE-SET,custom_direct,DIRECT
  - RULE-SET,ADs_merged,ADBlock
  - RULE-SET,httpdns,ADBlock
  - RULE-SET,category-cngames,DIRECT
  - RULE-SET,win-update,DIRECT
  - AND,((NETWORK,UDP),(DST-PORT,443),(RULE-SET,youtube)),ADBlock
  - RULE-SET,speedtest,Speedtest
  - RULE-SET,apple_proxy,Apple
  - RULE-SET,biliintl,èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,tracker,Tracker
  - RULE-SET,ai,AI
  - RULE-SET,youtube,YouTube
  - RULE-SET,google_site,Google
  - RULE-SET,google_ip,Google
  - RULE-SET,category-porn,Porns
  - RULE-SET,bilibili,Bilibili
  - RULE-SET,tg_site,Telegram
  - RULE-SET,tg_ip,Telegram
  - RULE-SET,github,Github
  - RULE-SET,microsoft,Microsoft
  - RULE-SET,bahamut,å°æ¹¾
  - RULE-SET,emby,Emby
  - RULE-SET,gfwlist,èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,cn_site,DIRECT
  - RULE-SET,cn_ip,DIRECT
  - MATCH,MATCH

rule-anchor:
  ip: &ip {type: http, interval: 86400, behavior: ipcidr, format: yaml}
  domain: &domain {type: http, interval: 86400, behavior: domain, format: yaml}
  domaintxt: &domaintxt {type: http, interval: 86400, behavior: domain, format: text}
  classical: &classical {type: http, interval: 86400, behavior: classical, format: yaml}
  classicaltxt: &classicaltxt {type: http, interval: 86400, behavior: classical, format: text}
  mrs: &mrs {type: http, interval: 86400, behavior: domain, format: mrs}
  mrsip: &mrsip {type: http, interval: 86400, behavior: ipcidr, format: mrs}

# https://wiki.metacubex.one/config/syntax/#_7
# https://wiki.metacubex.one/config/rule-providers/content/#rule-providers
rule-providers:
  custom_direct:
    <<: *domain
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/JohnsonRan/CRules/master/rules/custom.yaml"
  custom_proxy:
    <<: *domain
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/JohnsonRan/CRules/master/rules/customProxy.yaml"
  custom_reject:
    <<: *domaintxt
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/JohnsonRan/CRules/master/rules/reject.txt"
  emby:
    <<: *classicaltxt
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/Repcz/Tool/X/Surge/Rules/Emby.list"
  ai:
    <<: *mrs
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/JohnsonRan/CRules/mihomo/rules/AIs_merged.mrs"
  ADs_merged:
    <<: *mrs
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/JohnsonRan/CRules/mihomo/rules/ADs_merged.mrs"
  biliintl:
    <<: *mrs
    url: "https://raw.ihtw.moe/github.com/MetaCubeX/meta-rules-dat/raw/meta/geo-lite/geosite/biliintl.mrs"
  tracker:
    <<: *mrs
    url: "https://raw.ihtw.moe/github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/tracker.mrs"
  youtube:
    <<: *mrs
    url: "https://raw.ihtw.moe/github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/youtube.mrs"
  google_site:
    <<: *mrs
    url: "https://raw.ihtw.moe/github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/google.mrs"
  google_ip:
    <<: *mrsip
    url: "https://raw.ihtw.moe/github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geoip/google.mrs"
  category-porn:
    <<: *mrs
    url: "https://raw.ihtw.moe/github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/category-porn.mrs"
  category-cngames:
    <<: *mrs
    url: "https://raw.ihtw.moe/github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/category-games@cn.mrs"
  bilibili:
    <<: *mrs
    url: "https://raw.ihtw.moe/github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/bilibili.mrs"
  tg_ip:
    <<: *mrsip
    url: "https://raw.ihtw.moe/github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geoip/telegram.mrs"
  tg_site:
    <<: *mrs
    url: "https://raw.ihtw.moe/github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/telegram.mrs"
  github:
    <<: *mrs
    url: "https://raw.ihtw.moe/github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/github.mrs"
  microsoft:
    <<: *mrs
    url: "https://raw.ihtw.moe/github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/microsoft.mrs"
  win-update:
    <<: *mrs
    url: "https://raw.ihtw.moe/github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/win-update.mrs"
  bahamut:
    <<: *mrs
    url: "https://raw.ihtw.moe/github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/bahamut.mrs"
  cn_site:
    <<: *mrs
    url: "https://raw.ihtw.moe/github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/cn.mrs"
  cn_ip:
    <<: *mrsip
    url: "https://raw.ihtw.moe/github.com/ForestL18/rules-dat/raw/mihomo/asn/combined/China-ASN-combined.mrs"
  httpdns:
    <<: *mrs 
    url: "https://raw.ihtw.moe/github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/category-httpdns-cn.mrs"
  apple:	
    <<: *mrs 
    url: "https://raw.ihtw.moe/github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/apple.mrs"
  apple_proxy:
    <<: *mrs
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/JohnsonRan/CRules/mihomo/rules/AppleProxy.mrs"
  speedtest:
    <<: *mrs
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/JohnsonRan/CRules/mihomo/rules/speedtest.mrs"
  gfwlist:
    <<: *mrs
    url: "https://raw.ihtw.moe/github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/gfw.mrs"
